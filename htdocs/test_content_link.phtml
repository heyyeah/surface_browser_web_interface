<?php
require_once 'config.php';
require_once 'db_functions.php';
require_once 'link_functions.php';

set_headers();

$db = connectToDatabase();

try {
    // Get next test content link
    $sql = "SELECT id, type, address FROM " . SB_DATA_TABLE . " 
            WHERE type = :type_test
            ORDER BY accessed ASC LIMIT 1";
            
    $stmt = $db->prepare($sql);
    $stmt->execute(['type_test' => TYPE_TEST_CONTENT]);
    
    $row = $stmt->fetch(PDO::FETCH_ASSOC);
    
    if ($row) {
        $id = $row['id'];
        $address = $row['address'];

        // Update the accessed timestamp
        $updateSql = "UPDATE " . SB_DATA_TABLE . " 
                     SET accessed = NOW() 
                     WHERE id = :id";
        $updateStmt = $db->prepare($updateSql);
        $updateStmt->execute(['id' => $id]);

        // Output the link with icon
        echo "<a href=\"" . htmlspecialchars($address) . "\"><img src=\"images/sb_url.gif\" alt=\"Link icon\"></a>";
    } else {
        echo "No test content links available.";
    }
} catch (PDOException $e) {
    error_log("Database error in test_content_link: " . $e->getMessage());
    echo "Error retrieving test content link.";
}
?>
